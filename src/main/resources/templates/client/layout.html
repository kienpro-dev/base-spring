<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">
        Rental Car</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Car - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180"
          th:href="@{/client/assets/images/icons/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32"
          th:href="@{/client/assets/images/icons/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16"
          th:href="@{/client/assets/images/icons/favicon-16x16.png}">
    <link rel="shortcut icon"
          th:href="@{/client/assets/images/icons/favicon.ico}">
    <meta name="apple-mobile-web-app-title" content="Car">
    <meta name="application-name" content="Car">
    <link rel="stylesheet"
          th:href="@{/client/assets/vendor/line-awesome/line-awesome/line-awesome/css/line-awesome.min.css}">
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
            href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
            rel="stylesheet">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" th:href="@{/client/assets/css/bootstrap.min.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/owl-carousel/owl.carousel.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/magnific-popup/magnific-popup.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/jquery.countdown.css}">
    <!-- Main CSS File -->
    <link rel="stylesheet" th:href="@{/client/assets/css/style.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/owl-carousel/owl.carousel.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/magnific-popup/magnific-popup.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/plugins/nouislider/nouislider.css}">
    <link rel="stylesheet"
          th:href="@{/client/assets/css/skins/skin-demo-14.css}">
    <link rel="stylesheet" th:href="@{/client/assets/css/demos/demo-14.css}">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" th:href="@{/client/assets/css/quick-view.css}">
</head>

<body>
<div class="page-wrapper">

    <div th:replace="client/fragments/header:: header"></div>

    <main class="main">

        <div layout:fragment="content"></div>

    </main>
    <!-- End .main -->

    <div th:replace="client/fragments/footer:: footer"></div>

</div>
<!-- End .page-wrapper -->
<button id="scroll-top" title="Back to Top">
    <i class="icon-arrow-up"></i>
</button>

<!-- Mobile Menu -->
<div class="mobile-menu-overlay"></div>
<!-- End .mobil-menu-overlay -->

<div th:replace="client/fragments/mobile-menu:: mobile-menu"></div>

<div th:replace="client/fragments/signin-modal:: signin-modal"></div>

<div th:replace="client/fragments/forgot-modal:: forgot-modal"></div>

<div th:replace="client/fragments/change-modal:: change-modal"></div>

<div th:replace="client/fragments/quick-view:: quick-view"></div>

<div th:replace="client/fragments/order-view:: order-view"></div>

<!-- Plugins JS File -->
<script th:src="@{/client/assets/js/jquery.min.js}"></script>
<script th:src="@{/client/assets/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/client/assets/js/jquery.hoverIntent.min.js}"></script>
<script th:src="@{/client/assets/js/jquery.waypoints.min.js}"></script>
<script th:src="@{/client/assets/js/superfish.min.js}"></script>
<script th:src="@{/client/assets/js/owl.carousel.min.js}"></script>
<script th:src="@{/client/assets/js/bootstrap-input-spinner.js}"></script>
<script th:src="@{/client/assets/js/jquery.magnific-popup.min.js}"></script>
<script th:src="@{/client/assets/js/jquery.plugin.min.js}"></script>
<script th:src="@{/client/assets/js/jquery.countdown.min.js}"></script>
<script th:src="@{/client/assets/js/nouislider.min.js}"></script>
<script th:src="@{/client/assets/js/jquery.elevateZoom.min.js}"></script>
<script th:src="@{/client/assets/js/bootstrap-input-spinner.js}"></script>
<script th:src="@{/client/assets/js/jquery.sticky-kit.min.js}"></script>
<!-- Main JS File -->
<script th:src="@{/client/assets/js/main.js}"></script>
<script th:src="@{/client/assets/js/demos/demo-14.js}"></script>
<script th:src="@{/client/assets/js/carOwner.js}"></script>
<script th:src="@{/client/assets/js/carDetails.js}"></script>


<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:src="@{/client/assets/api-all.js}"></script>
<script th:src="@{/client/assets/quick-view.js}"></script>
<script th:src="@{/client/assets/auth.js}"></script>
<script th:src="@{/client/assets/cart.js}"></script>
<script th:src="@{/client/assets/view-cart.js}"></script>
<script th:src="@{/client/assets/info-account.js}"></script>
<script th:src="@{/client/assets/like.js}"></script>
<script th:src="@{/client/assets/order-view.js}"></script>
<script th:src="@{/client/assets/order-list.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/

    var error = /*[[${error}]]*/ '';
    if (error !== null) {
        Swal.fire({
            icon: 'error',
            title: 'Thông báo lỗi',
            text: error,
        })
    }

    var isSuccess = [[${isSuccess}]];
    var isAuth = [[${isAuth}]];
    var isFail = [[${isAuth}]];
    var carId = [[${carId}]];
    if (isFail) {
        if (isAuth) {
            Swal.fire({
                icon: 'error',
                title: 'Thuê xe thất bại',
                text: 'Xe đã được đặt ở thời điểm này',
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = new URL(window.location.href).origin + "/car/check-out?id=" + carId;
                }
            })
        }
    }
    if (isSuccess) {
        if (isAuth) {
            Swal.fire({
                icon: 'success',
                title: 'Thông báo',
                text: 'Thuê xe thành công',
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = new URL(window.location.href).origin + "/car/booking-list";
                }
            })
        }
    }

    function getCurrentDate() {
        const today = new Date();
        return today.toISOString().split('T')[0];
    }

    function getCurrentTime() {
        const now = new Date();
        return now.toTimeString().split(' ')[0].slice(0, 5);
    }

    function setDefaultValues() {
        const startDateInput = document.getElementById("start_date");
        const startTimeInput = document.getElementById("start_time");
        const endDateInput = document.getElementById("end_date");
        const endTimeInput = document.getElementById("end_time");

        const currentDate = getCurrentDate();
        const currentTime = getCurrentTime();

        startDateInput.value = currentDate;
        startTimeInput.value = currentTime;

        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowDate = tomorrow.toISOString().split('T')[0];

        endDateInput.value = tomorrowDate;
        endTimeInput.value = currentTime;

        calculateAndUpdate();
    }

    function calculateDaysBetweenDates() {
        const startDate = document.getElementById("start_date").value;
        const startTime = document.getElementById("start_time").value;
        const endDate = document.getElementById("end_date").value;
        const endTime = document.getElementById("end_time").value;

        if (startDate && endDate) {
            const start = new Date(startDate + 'T' + (startTime || '00:00'));
            const end = new Date(endDate + 'T' + (endTime || '00:00'));

            const oneDay = 24 * 60 * 60 * 1000;
            return Math.round(Math.abs((end - start) / oneDay)) + 1;
        }
        return 0;
    }

    function formatDecimal(value) {
        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' VND';
    }

    function calculateAndUpdate() {
        const totalDays = calculateDaysBetweenDates();
        document.getElementById("total_days").textContent = totalDays;

        const dailyCost = parseFloat(document.getElementById("daily_cost").value) || 0;

        const totalCost = dailyCost * totalDays;
        document.getElementById("total_cost").textContent = formatDecimal(totalCost);
    }

    document.getElementById("start_date").addEventListener("change", calculateAndUpdate);
    document.getElementById("start_time").addEventListener("change", calculateAndUpdate);
    document.getElementById("end_date").addEventListener("change", calculateAndUpdate);
    document.getElementById("end_time").addEventListener("change", calculateAndUpdate);

    window.onload = setDefaultValues;


    /*]]>*/
</script>
</body>

</html>